import{q as v,v as N,j as e,r as b,Y as c,$ as k}from"./app-CN6afjPF.js";import{A as y}from"./AuthenticatedLayout-B1eQzEZL.js";import{L as f,P as C,B as _}from"./BookmarkButton-BnArKECm.js";import{V as $}from"./Footer-D3isJAoz.js";import"./Header-DY3YGse3.js";import"./TextInput-CXQe83td.js";import"./index.es-DJeJjBC4.js";function S({astuceId:s,parentId:a=null,onCancelReply:t=null}){const{auth:n}=v().props,{props:o}=v(),m=o.flash||{},{data:h,setData:d,post:x,processing:l,errors:r,reset:u}=N({contenus:"",astuce_id:s,parent_id:a}),j=p=>{p.preventDefault(),x(route("commentairesastuces.store"),{preserveScroll:!0,onSuccess:()=>{u("contenus"),$.success("Commentaire envoyé avec succes"),t&&t()},onError:()=>{const i=document.querySelector(".text-error");i&&i.scrollIntoView({behavior:"smooth",block:"center"})}})};return n.user?e.jsxs("div",{className:"mt-8",id:"comment-form",children:[m.success&&e.jsx("div",{className:"alert alert-success mb-4",children:e.jsx("div",{children:e.jsx("span",{children:m.success})})}),e.jsx("h3",{className:"text-xl font-semibold mb-4 text-base-content",children:a?"Répondre au commentaire":"Laisser un commentaire"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("textarea",{className:`textarea textarea-bordered h-24 ${r.contenus?"textarea-error":""}`,placeholder:"Votre commentaire...",value:h.contenus,onChange:p=>d("contenus",p.target.value),disabled:l}),r.contenus&&e.jsx("span",{className:"text-error text-sm mt-1 block",children:r.contenus})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"submit",className:`btn btn-primary ${l?"loading":""}`,disabled:l,children:l?"":a?"Publier la réponse":"Publier le commentaire"}),a&&e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:t,disabled:l,children:"Annuler"})]})]})]}):e.jsx("div",{className:"mt-8",children:e.jsx("div",{className:"alert alert-warning",children:e.jsxs("div",{children:[e.jsx("span",{children:"Vous devez être connecté pour commenter"}),e.jsx(Link,{href:route("login"),className:"link link-primary ml-2",children:"Se connecter"})]})})})}function w({comment:s,auth:a,astuceId:t}){const n=t||s.astuce_id,[o,m]=b.useState(!1),[h,d]=b.useState(!1),{data:x,setData:l,post:r,processing:u,reset:j}=N({contenus:"",parent_id:s.id??"",astuce_id:t||s.astuce_id}),p=i=>{i.preventDefault(),r(route("commentsastuces.store",{astuce:n}),{preserveScroll:!0,onSuccess:g=>{j("contenus"),d(!1),m(!0),g.props.comment&&(s.replies=[...s.replies||[],g.props.comment],s.replies_count=(s.replies_count||0)+1)}})};return e.jsx("div",{className:"pb-4 last:pb-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{href:route("users.show",{user:`${s.user.name.toLowerCase().replace(/\s+/g,"-")}-${s.user.id}`}),className:"flex-shrink-0",children:e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-10 rounded-full",children:e.jsx("img",{src:s.user.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(s.user.name)}`,alt:s.user.name})})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{href:route("users.show",{user:`${s.user.name.toLowerCase().replace(/\s+/g,"-")}-${s.user.id}`}),className:"font-semibold hover:text-primary hover:underline",children:s.user.name}),e.jsx("span",{className:"text-sm opacity-70",children:s.created_at})]}),e.jsx("p",{className:"mt-1",children:s.contenus}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsx(f,{likeableId:s.id,likeableType:"App\\Models\\CommentaireAstuce",initialLikes:s.stats.likes_count,initialIsLiked:s.has_liked}),s.replies&&s.replies.length>0&&e.jsxs("button",{onClick:()=>m(!o),className:"flex items-center gap-1 hover:text-primary",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsxs("span",{children:[s.replies_count||s.replies.length," réponses"]})]}),a.user&&e.jsx("button",{onClick:()=>d(!h),className:"hover:text-primary hover:underline",children:"Répondre"})]}),h&&a.user&&e.jsxs("form",{className:"mt-4 flex gap-3",onSubmit:p,children:[e.jsx("div",{className:"avatar flex-shrink-0",children:e.jsx("div",{className:"w-8 rounded-full",children:e.jsx("img",{src:a.user.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.user.name)}`,alt:a.user.name})})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{type:"text",name:"contenus",value:x.contenus,onChange:i=>l("contenus",i.target.value),placeholder:"Écrire une réponse...",className:"input input-bordered input-sm w-full",required:!0}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:u,children:u?"Envoi...":"Envoyer"})]})]}),o&&s.replies&&s.replies.length>0&&e.jsx("div",{className:"mt-3 pl-4 border-l-2 border-base-200 space-y-3",children:s.replies.map(i=>e.jsx(w,{comment:i,auth:a,astuceId:n},i.id))})]})]})})}function z({astuce:s}){var d,x,l;const[a,t]=b.useState(!1),{auth:n}=v().props,o=a?s.comments:(d=s.comments)==null?void 0:d.slice(0,3),h=(r=>{const u=typeof r=="object"?r.title:r;return`language-${String(u).toLowerCase().trim().replace(/\s+/g,"-")}`})(s.categorie);return e.jsxs(y,{children:[e.jsxs(k,{children:[e.jsx("title",{children:s.title}),e.jsx("meta",{name:"description",content:s.meta_description||s.title})]}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"text-sm breadcrumbs mb-6",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(c,{href:route("home"),children:"Accueil"})}),e.jsx("li",{children:e.jsx(c,{href:route("astuces.index"),children:"Astuces"})}),e.jsx("li",{className:"text-primary font-medium",children:s.title})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"lg:w-2/3",children:[e.jsx("article",{className:"card bg-base-200 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("header",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(c,{href:route("users.show",{user:`${s.author.name.toLowerCase().replace(/\s+/g,"-")}-${s.author.id}`}),className:"flex items-center gap-3 group",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-12 rounded-full",children:s.author.image?e.jsx("img",{className:"w-full h-full object-cover transition-all duration-500 group-hover:scale-110",src:`${window.location.origin}/storage/${s.author.image}`,alt:s.titre}):e.jsx("img",{src:`https://ui-avatars.com/api/?name=${s.author.name}`,alt:s.author.name})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold group-hover:text-primary transition",children:s.author.name}),e.jsx("time",{dateTime:s.created_at,className:"text-sm text-gray-500",children:s.created_at})]})]}),e.jsx("div",{className:"flex gap-2",children:(x=s.tags)==null?void 0:x.map(r=>e.jsxs(c,{href:route("astuces.index",{tag:r.name}),className:"badge badge-outline hover:badge-primary transition",children:["#",r.name]},r.id))})]}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:s.title}),e.jsx("div",{className:`badge badge-lg badge-${s.categorie.couleur||"primary"}`,children:s.categorie.titre})]}),s.image&&e.jsx("figure",{className:"mb-6 rounded-lg overflow-hidden",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-auto max-h-[32rem] object-cover"})}),s.video&&e.jsx("div",{className:"aspect-w-16 aspect-h-9 mb-6",children:e.jsx("iframe",{src:s.video.replace("watch?v=","embed/"),className:"w-full h-[32rem] rounded-lg",allowFullScreen:!0})}),e.jsx("div",{className:"prose max-w-none mb-8",dangerouslySetInnerHTML:{__html:s.contenus}}),s.codesource&&e.jsx(C,{code:s.codesource,language:h}),e.jsxs("div",{className:"flex items-center justify-between border-t border-b border-base-300 py-4 my-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("button",{className:"btn btn-ghost btn-sm gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("span",{children:s.comments_count||0})]}),e.jsx(f,{likeableId:s.id,likeableType:"App\\Models\\Astuce",initialLikes:s.stats.likes_count,initialIsLiked:s.has_liked}),n.user&&e.jsx(_,{bookmarkableId:s.id,bookmarkableType:"App\\Models\\Astuce",initialIsBookmarked:s.is_bookmarked})]}),e.jsxs("div",{className:"text-sm",children:[s.stats.views_count||0," vues"]})]})]})}),e.jsx("section",{className:"card bg-base-100 shadow-xl mt-8",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6",children:["Commentaires (",s.comments_count||0,")"]}),n.user?e.jsx(S,{astuceId:s.id,className:"mb-6"}):e.jsx("div",{className:"alert alert-info mb-6",children:e.jsxs("div",{children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current flex-shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:"Connectez-vous pour astuceer un commentaire"})]})}),e.jsx("div",{className:"space-y-6",children:o==null?void 0:o.map(r=>e.jsx(w,{comment:r,auth:n},r.id))}),s.comments_count>3&&!a&&e.jsxs("button",{onClick:()=>t(!0),className:"btn btn-link mt-4",children:["Voir tous les commentaires (",s.comments_count,")"]})]})})]}),e.jsx("div",{className:"lg:w-1/3",children:e.jsxs("div",{className:"sticky top-4 space-y-6",children:[s.astucesLiees.length>0&&e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Astuces similaires"}),e.jsx("div",{className:"space-y-4",children:(l=s.astucesLiees)==null?void 0:l.map(r=>e.jsx(c,{href:route("astuces.show",r.slug),className:"block group",children:e.jsxs("div",{className:"flex gap-3",children:[r.image?e.jsx("div",{className:"w-20 h-20 flex-shrink-0 rounded overflow-hidden",children:e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"avatar avatar-placeholder",children:e.jsx("div",{className:"bg-primary text-primary-content w-12 rounded-full",children:e.jsx("span",{children:r.title.substring(0,2)})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold group-hover:text-primary transition",children:r.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-6 rounded-full",children:e.jsx("img",{src:r.author.image||`https://ui-avatars.com/api/?name=${r.author.name}`,alt:r.author.name})})}),e.jsx("span",{className:"text-sm",children:r.author.name})]})]})]})},r.id))})]})}),e.jsxs("div",{className:"card bg-base-200 shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"À propos de l'auteur"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-16 rounded-full",children:s.author.image?e.jsx("img",{className:"w-full h-full object-cover transition-all duration-500 group-hover:scale-110",src:`${window.location.origin}/storage/${s.author.image}`,alt:s.titre}):e.jsx("img",{src:`https://ui-avatars.com/api/?name=${s.author.name}`,alt:s.author.name})})}),e.jsx("div",{children:e.jsx("h4",{className:"font-bold",children:s.author.name})})]}),s.author.bio&&e.jsx("p",{className:"text-opacity-1",children:s.author.bio}),e.jsx(c,{href:route("users.show",{user:`${s.author.name.toLowerCase().replace(/\s+/g,"-")}-${s.author.id}`}),className:"btn btn-outline btn-sm mt-4",children:"Voir le profil"})]})]})})]})]})]})}export{z as default};
