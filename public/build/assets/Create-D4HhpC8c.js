import{v as E,r as d,j as e,$ as A}from"./app-Dg0zn_4b.js";import{A as T}from"./AuthenticatedLayout-DEizoF2w.js";import{R as S}from"./index-Bbgx9r6w.js";import"./Footer-cJEit7pN.js";import"./Header-uRdT3SQM.js";import"./TextInput-BAIE_OV-.js";function P({categories:p,tags:b}){const{data:r,setData:t,post:g,processing:m,errors:a}=E({titre:"",contenus:"",description:"",video:"",image:null,categorie_id:"",tags:[],etat:!1}),[x,j]=d.useState(null),[i,N]=d.useState([]),n=d.useRef(null),f={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"sub"},{script:"super"}],[{list:"ordered"},{list:"bullet"}],["link","image","code-block"],["clean"],[{font:[]}],[{align:[]}]]},v=()=>{const l=document.createElement("input");l.setAttribute("type","file"),l.setAttribute("accept","image/*"),l.click(),l.onchange=async()=>{const s=l.files[0];if(!s)return;const c=new FormData;c.append("image",s);try{const u=await(await fetch(route("upload.image"),{method:"POST",body:c,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"}})).json();if(u.success){const h=n.current.getEditor(),k=h.getSelection();h.insertEmbed(k.index,"image",u.url)}else console.error("Erreur lors de l'upload",u.message)}catch(o){console.error("Erreur lors de l'upload",o),alert("Une erreur est survenue lors de l'upload de l'image")}}};d.useEffect(()=>{if(n.current){const l=n.current.getEditor();l.getModule("toolbar").addHandler("image",v),r.contenus&&l.clipboard.dangerouslyPasteHTML(r.contenus)}},[]);const y=l=>{const s=l.target.files[0];if(s){t("image",s);const c=new FileReader;c.onload=o=>j(o.target.result),c.readAsDataURL(s)}},w=l=>{const s=i.includes(l)?i.filter(c=>c!==l):[...i,l];s.length<=4?(N(s),t("tags",s)):alert("Vous ne pouvez sélectionner que 4 tags maximum")},C=l=>{if(l.preventDefault(),n.current){const s=n.current.getEditor();t("contenus",s.root.innerHTML)}g(route("astuces.store"))};return e.jsxs(T,{children:[e.jsx(A,{title:"Créer une astuce"}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"breadcrumbs text-sm mb-6",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:route("home"),children:"Accueil"})}),e.jsx("li",{children:e.jsx("a",{href:route("astuces.index"),children:"Astuces"})}),e.jsx("li",{children:"Créer une astuce"})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title text-2xl mb-6",children:"Créer une nouvelle astuce"}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Titre *"})}),e.jsx("input",{type:"text",className:`input input-bordered w-full ${a.titre?"input-error":""}`,value:r.titre,onChange:l=>t("titre",l.target.value),placeholder:"Le titre de l'astuce"}),a.titre&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.titre})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Catégorie *"})}),e.jsxs("select",{className:`select select-bordered w-full ${a.categorie_id?"select-error":""}`,value:r.categorie_id,onChange:l=>t("categorie_id",l.target.value),children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),p.map(l=>e.jsx("option",{value:l.id,children:l.titre},l.id))]}),a.categorie_id&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.categorie_id})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Lien vidéo YouTube (optionnel)"})}),e.jsx("input",{type:"url",className:`input input-bordered w-full ${a.video?"input-error":""}`,value:r.video,onChange:l=>t("video",l.target.value),placeholder:"https://www.youtube.com/watch?v=..."}),a.video&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.video})})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Description *"})}),e.jsx("textarea",{className:`textarea textarea-bordered h-24 ${a.description?"textarea-error":""}`,value:r.description,onChange:l=>t("description",l.target.value),placeholder:"Description de l'astuce pour faciliter la recherche"}),a.description&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.description})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tags * (maximum 4)"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(l=>e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:i.includes(l.id),onChange:()=>w(l.id)}),e.jsx("span",{className:"ml-2 badge badge-outline",children:l.nom})]},l.id))}),a.tags&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.tags})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Contenu *"})}),e.jsx("div",{className:"bg-base-100 rounded-lg",children:e.jsx(S,{ref:n,theme:"snow",value:r.contenus,onChange:l=>t("contenus",l),modules:f,placeholder:"Entrez le contenu de votre astuce...",style:{minHeight:"300px"}})}),a.contenus&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.contenus})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Image"})}),e.jsx("input",{type:"file",className:`file-input file-input-bordered w-full ${a.image?"file-input-error":""}`,accept:"image/*",onChange:y}),a.image&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.image})})]}),x&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Aperçu"})}),e.jsx("img",{src:x,alt:"Aperçu",className:"max-h-48 rounded-lg object-cover"})]})]}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"cursor-pointer label",children:[e.jsx("span",{className:"label-text",children:"Publier immédiatement"}),e.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:r.etat,onChange:l=>t("etat",l.target.checked)})]})}),e.jsxs("div",{className:"card-actions justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>window.history.back(),children:"Annuler"}),e.jsx("button",{type:"submit",className:`btn btn-primary ${m?"loading":""}`,disabled:m,children:m?"Création...":"Créer l'astuce"})]})]})]})})]})]})}export{P as default};
