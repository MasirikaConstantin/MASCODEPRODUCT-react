import{v as T,r as d,j as e,$ as _}from"./app-BwmMsR3-.js";import{A as $}from"./AuthenticatedLayout-BMztMp_1.js";import{R as D}from"./index-BMekV6o0.js";/* empty css                   */import"./Footer-BpZ9e4JE.js";import"./Header-B6qQlfqo.js";import"./TextInput-Bd2RCDDY.js";function M({astuce:t,categories:N,tags:f}){var g;const{data:i,setData:r,put:R,post:v,processing:m,errors:a}=T({titre:t.titre||"",contenus:t.contenus||"",description:t.description||"",video:t.video||"",image:null,remove_image:!1,categorie_id:t.categorie_id||"",tags:((g=t.tags)==null?void 0:g.map(l=>l.id))||[],etat:t.etat||!1,_method:"PUT"}),[u,h]=d.useState(t.image||null),[x,b]=d.useState(!1),c=d.useRef(null),y={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"sub"},{script:"super"}],[{list:"ordered"},{list:"bullet"}],["link","image","code-block"],["clean"],[{font:[]}],[{align:[]}]]},w=()=>{const l=document.createElement("input");l.setAttribute("type","file"),l.setAttribute("accept","image/*"),l.click(),l.onchange=async()=>{const s=l.files[0];if(!s)return;const n=new FormData;n.append("image",s);try{const p=await(await fetch(route("upload.image"),{method:"POST",body:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"}})).json();if(p.success){const j=c.current.getEditor(),A=j.getSelection();j.insertEmbed(A.index,"image",p.url)}else console.error("Erreur lors de l'upload",p.message)}catch(o){console.error("Erreur lors de l'upload",o),alert("Une erreur est survenue lors de l'upload de l'image")}}};d.useEffect(()=>{if(c.current){const l=c.current.getEditor();l.getModule("toolbar").addHandler("image",w),l.clipboard.dangerouslyPasteHTML(i.contenus)}},[]);const k=l=>{const s=l.target.files[0];if(s){r("image",s),r("remove_image",!1),b(!0);const n=new FileReader;n.onload=o=>h(o.target.result),n.readAsDataURL(s)}},C=l=>{const s=i.tags||[],n=s.includes(l)?s.filter(o=>o!==l):[...s,l];n.length<=4?r("tags",n):alert("Vous ne pouvez sélectionner que 4 tags maximum")},E=l=>{if(l.preventDefault(),c.current){const s=c.current.getEditor();r("contenus",s.root.innerHTML)}v(route("astuces.update",t.id),{preserveScroll:!0,forceFormData:!0})},S=()=>{r("image",null),r("remove_image",!0),h(null),b(!1)};return e.jsxs($,{children:[e.jsx(_,{title:`Éditer ${t.titre}`}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"breadcrumbs text-sm mb-6",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("a",{href:route("home"),children:"Accueil"})}),e.jsx("li",{children:e.jsx("a",{href:route("astuces.index"),children:"Astuces"})}),e.jsxs("li",{children:['Éditer "',t.titre,'"']})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title text-2xl mb-6",children:"Éditer l'astuce"}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Titre *"})}),e.jsx("input",{type:"text",className:`input input-bordered w-full ${a.titre?"input-error":""}`,value:i.titre,onChange:l=>r("titre",l.target.value),placeholder:"Le titre de l'astuce"}),a.titre&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.titre})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Catégorie *"})}),e.jsxs("select",{className:`select select-bordered w-full ${a.categorie_id?"select-error":""}`,value:i.categorie_id,onChange:l=>r("categorie_id",l.target.value),children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),N.map(l=>e.jsx("option",{value:l.id,children:l.titre},l.id))]}),a.categorie_id&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.categorie_id})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Lien vidéo YouTube (optionnel)"})}),e.jsx("input",{type:"url",className:`input input-bordered w-full ${a.video?"input-error":""}`,value:i.video,onChange:l=>r("video",l.target.value),placeholder:"https://www.youtube.com/watch?v=..."}),a.video&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.video})})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Description *"})}),e.jsx("textarea",{className:`textarea textarea-bordered h-24 ${a.description?"textarea-error":""}`,value:i.description,onChange:l=>r("description",l.target.value),placeholder:"Description de l'astuce pour faciliter la recherche"}),a.description&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.description})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tags * (maximum 4)"})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(l=>{var s;return e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"checkbox checkbox-primary",checked:((s=i.tags)==null?void 0:s.includes(l.id))||!1,onChange:()=>C(l.id)}),e.jsx("span",{className:"ml-2 badge badge-outline",children:l.nom})]},l.id)})}),a.tags&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.tags})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Contenu *"})}),e.jsx("div",{className:"bg-base-100 rounded-lg",children:e.jsx(D,{ref:c,theme:"snow",value:i.contenus,onChange:l=>r("contenus",l),modules:y,placeholder:"Entrez le contenu de votre astuce...",style:{minHeight:"300px"}})}),a.contenus&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.contenus})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Image ",t.image&&!x&&"actuelle"]})}),e.jsx("input",{type:"file",className:`file-input file-input-bordered w-full ${a.image?"file-input-error":""}`,accept:"image/*",onChange:k}),a.image&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.image})}),u&&e.jsx("button",{type:"button",className:"btn btn-sm btn-error mt-2",onClick:S,children:x?"Supprimer la nouvelle image":"Supprimer l'image actuelle"})]}),u&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:x?"Aperçu nouvelle image":"Image actuelle"})}),e.jsx("img",{src:u,alt:"Aperçu",className:"max-h-48 rounded-lg object-cover"})]})]}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"cursor-pointer label",children:[e.jsx("span",{className:"label-text",children:"Publier immédiatement"}),e.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:i.etat,onChange:l=>r("etat",l.target.checked)})]})}),e.jsxs("div",{className:"card-actions justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>window.history.back(),children:"Annuler"}),e.jsx("button",{type:"submit",className:`btn btn-primary ${m?"loading":""}`,disabled:m,children:m?"Enregistrement...":"Enregistrer les modifications"})]})]})]})})]})]})}export{M as default};
