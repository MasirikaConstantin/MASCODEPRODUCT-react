import{q as U,r as n,a as W,j as e,Y as H}from"./app-D-V_bWok.js";import{B as A}from"./Base-DGA2ASa7.js";import{i as O}from"./inertia-CE98trGV.js";import"./Footer-DuUkB7kl.js";import"./Header-B56VDcnT.js";import"./TextInput-CU-rZJ6L.js";function Q({results:R=[],total_results:S=0,total_posts:T=0,total_astuces:M=0,filters:r={},authors:L=[],error:q=null}){const{props:X}=U(),[a,m]=n.useState({query:r.query||"",type:r.type||"all",author:r.author||"",difficulty:r.difficulty||"",has_video:r.has_video||!1,date_from:r.date_from||"",date_to:r.date_to||"",per_page:r.per_page||15,page:r.page||1}),[p,f]=n.useState(R||[]),[b,v]=n.useState(!1),[c,N]=n.useState(S||0),[E,y]=n.useState(T||0),[$,w]=n.useState(M||0),[_,P]=n.useState(L||[]),[k,u]=n.useState(q),[x,z]=n.useState(!1);n.useEffect(()=>{const s=setTimeout(()=>{(a.query||a.type!=="all"||a.author||a.difficulty||a.has_video||a.date_from||a.date_to)&&B()},500);return()=>clearTimeout(s)},[a]);const B=async()=>{v(!0),u(null);try{const s=new URLSearchParams;Object.entries(a).forEach(([d,i])=>{i!==""&&i!==!1&&i!==null&&s.append(d,i)});const t=(await W.get(route("advanced-search"),{params:s,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}})).data;f(t.results||[]),N(t.total_results||0),y(t.total_posts||0),w(t.total_astuces||0),P(t.authors||[])}catch(s){console.error("Search error:",s),u("Une erreur est survenue lors de la recherche"),f([]),N(0),y(0),w(0)}finally{v(!1)}},o=s=>{const{name:l,value:t,type:d,checked:i}=s.target;m(h=>({...h,[l]:d==="checkbox"?i:t,page:1}))},j=s=>{m(l=>({...l,page:s})),window.scrollTo({top:0,behavior:"smooth"})},g=()=>{m({query:"",type:"all",author:"",difficulty:"",has_video:!1,date_from:"",date_to:"",per_page:15,page:1}),u(null)},C=(s,l)=>{if(!l||!s)return s;const t=new RegExp(`(${D(l)})`,"gi");return s.replace(t,'<span class="bg-yellow-200">$1</span>')};function D(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const I=s=>{if(!s.slug)return;const l=s.type==="post"?"posts.show":"astuces.show";O.visit(route(l,s.slug))};return k?e.jsx(A,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"alert alert-error",children:[e.jsx("svg",{className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:k}),e.jsx("button",{onClick:g,className:"btn btn-sm",children:"Réessayer"})]})})})}):e.jsx(A,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Recherche avancée"}),e.jsxs("div",{className:"bg-base-300 rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-grow relative",children:[e.jsx("input",{type:"text",name:"query",placeholder:"Rechercher des articles, astuces...",className:"input input-bordered w-full pl-12",value:a.query,onChange:o}),e.jsx("div",{className:"absolute left-4 top-1/2 transform -translate-y-1/2",children:b?e.jsx("span",{className:"loading loading-spinner loading-sm text-primary"}):e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),e.jsx("button",{onClick:()=>z(!x),className:"btn btn-outline",children:x?"Masquer les filtres":"Afficher les filtres"})]}),x&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Type de contenu"})}),e.jsxs("select",{name:"type",className:"select select-bordered w-full",value:a.type,onChange:o,children:[e.jsx("option",{value:"all",children:"Tous les types"}),e.jsx("option",{value:"post",children:"Articles seulement"}),e.jsx("option",{value:"astuce",children:"Astuces seulement"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Auteur"})}),e.jsxs("select",{name:"author",className:"select select-bordered w-full",value:a.author,onChange:o,children:[e.jsx("option",{value:"",children:"Tous les auteurs"}),Array.isArray(_)&&_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Difficulté (astuces)"})}),e.jsxs("select",{name:"difficulty",className:"select select-bordered w-full",value:a.difficulty,onChange:o,disabled:a.type==="post",children:[e.jsx("option",{value:"",children:"Toutes difficultés"}),e.jsx("option",{value:"facile",children:"Facile"}),e.jsx("option",{value:"moyen",children:"Moyen"}),e.jsx("option",{value:"difficile",children:"Difficile"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Contient une vidéo"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"has_video",className:"toggle toggle-primary",checked:a.has_video,onChange:o,disabled:a.type==="astuce"}),e.jsx("span",{className:"ml-2",children:a.has_video?"Oui":"Non"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date de publication (début)"})}),e.jsx("input",{type:"date",name:"date_from",className:"input input-bordered w-full",value:a.date_from,onChange:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Date de publication (fin)"})}),e.jsx("input",{type:"date",name:"date_to",className:"input input-bordered w-full",value:a.date_to,onChange:o,min:a.date_from})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Résultats par page"})}),e.jsxs("select",{name:"per_page",className:"select select-bordered w-full",value:a.per_page,onChange:o,children:[e.jsx("option",{value:"5",children:"5"}),e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"}),e.jsx("option",{value:"50",children:"50"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:g,className:"btn btn-outline btn-error",children:"Réinitialiser"})})]})]}),e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:c>0?e.jsxs(e.Fragment,{children:["Affichage de ",e.jsx("span",{className:"font-semibold",children:(a.page-1)*a.per_page+1})," à"," ",e.jsx("span",{className:"font-semibold",children:Math.min(a.page*a.per_page,c)})," ","sur ",e.jsx("span",{className:"font-semibold",children:c})," résultats"]}):"Aucun résultat trouvé"}),c>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["(",E," articles et ",$," astuces)"]})]})}),b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("span",{className:"loading loading-spinner loading-lg text-primary"})}):Array.isArray(p)&&p.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4 mb-6",children:p.map((s,l)=>{var t,d,i;return e.jsx("div",{children:e.jsx(H,{className:"p-6 hover:shadow-md transition-shadow cursor-pointer",href:route(s.type==="post"?"posts.show":"astuces.show",s.slug),children:e.jsx("div",{className:"bg-base-300 rounded-lg shadow p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>I(s),children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[s.has_image&&s.image&&e.jsx("div",{className:"flex-shrink-0 w-full md:w-40 h-40 bg-base-300 rounded-lg overflow-hidden",children:e.jsx("img",{src:`${window.location.origin}/storage/${s.image}`,alt:s.title||"Image",className:"w-full h-full object-cover",onError:h=>{h.target.style.display="none"}})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h2",{className:"text-xl font-bold",dangerouslySetInnerHTML:{__html:C(s.title||"Sans titre",a.query)}}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s.published_at||"Date inconnue"}),s.type==="post"&&s.has_video&&e.jsx("span",{className:"badge badge-primary",children:"Vidéo"})]})]}),e.jsx("p",{className:"text-gray-600 mb-4 line-clamp-2",dangerouslySetInnerHTML:{__html:C(s.excerpt||"",a.query)}}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"w-8 h-8 rounded-full",children:e.jsx("img",{src:((t=s.user)==null?void 0:t.avatar)||"/images/default-avatar.png",alt:((d=s.user)==null?void 0:d.name)||"Utilisateur",onError:h=>{h.target.src="/images/default-avatar.png"}})})}),e.jsx("span",{className:"text-sm font-medium",children:((i=s.user)==null?void 0:i.name)||"Utilisateur inconnu"})]}),s.type==="post"&&e.jsx("span",{className:"text-xs badge badge-accent  px-2 py-1 rounded ",children:"Post"}),s.type==="astuce"&&e.jsx("span",{className:"text-xs badge badge-secondary px-2 py-1 rounded ",children:"Astuce"})]})]})]})})})},`${s.type}-${s.id}-${l}`)})}),c>a.per_page&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("div",{className:"join",children:[e.jsx("button",{className:"join-item btn",onClick:()=>j(a.page-1),disabled:a.page===1,children:"«"}),Array.from({length:Math.ceil(c/a.per_page)},(s,l)=>{const t=l+1,d=Math.ceil(c/a.per_page);return t===1||t===d||t>=a.page-2&&t<=a.page+2?e.jsx("button",{className:`join-item btn ${a.page===t?"btn-active":""}`,onClick:()=>j(t),children:t},t):t===a.page-3||t===a.page+3?e.jsx("span",{className:"join-item btn btn-disabled",children:"..."},t):null}),e.jsx("button",{className:"join-item btn",onClick:()=>j(a.page+1),disabled:a.page*a.per_page>=c,children:"»"})]})})]}):e.jsxs("div",{className:"bg-base-300 rounded-lg shadow p-12 text-center",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium",children:"Aucun résultat trouvé"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Essayez d'ajuster vos critères de recherche ou utilisez des termes différents."}),e.jsx("button",{onClick:g,className:"mt-4 btn btn-primary",children:"Réinitialiser les filtres"})]})]})})})}export{Q as default};
